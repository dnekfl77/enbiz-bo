<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.enbiz.bo.app.repository.system.StUserBaseTrxMapper">

	<!-- 패스워드 변경   -->
	<update id="updateChagePassword" parameterType="StUserBase">
		UPDATE 	  ST_USER_BASE /* stUserBaseTrx.updateChagePassword */
		SET 	  PWD 		   = #{pwd}
			 	, LST_PWD_CHG_DTM = NOW()
			 	, PWD_CNTN_FAIL_CNT  = 0
		  	<if test="pwdIniYn != null and pwdIniYn != ''">
			 	, PWD_INI_YN		= #{pwdIniYn}
		  	</if>
			 	, SYS_MOD_ID 	    = #{userId}
			 	, SYS_MOD_DTM 	    = NOW()
		 WHERE 	  USER_ID = #{userId}
	</update>

	<!-- 비밀번호 찾기 시 아이디 잠금 해제   -->
	<update id="updateIdUnlock" parameterType="StUserBase">
		UPDATE ST_USER_BASE /* stUserBaseTrx.updateIdUnlock */
		   SET PWD_LOCK_YN = 'N'
		 WHERE USER_ID	= #{userId}
  		   AND PWD_LOCK_YN = 'Y'
	</update>

	<!-- 90일 잠금설정   -->
	<update id="updateIdLockYnCheck" parameterType="StUserBase">
		UPDATE ST_USER_BASE /* stUserBaseTrx.updateIdLockYnCheck */
		   SET PWD_LOCK_YN  = 'Y'
		 WHERE USER_ID	 = #{userId}
		   AND DATE_TRUNC('day', NOW() + INTERVAL '-3 MONTHS') > RCNT_USE_DTM
	</update>

	<!-- 로그인 성공 -->
	<update id="updateLoginSuccess" parameterType="StUserBase">
		UPDATE ST_USER_BASE /* stUserBaseTrx.updateLoginSuccess */
		   SET RCNT_USE_DTM = NOW()
			 , PWD_CNTN_FAIL_CNT = 0
		 WHERE USER_ID = #{userId}
	</update>

	<!-- 패스워드 변경   -->
	<update id="updatePasswordByPasswordInitialize" parameterType="StUserBase">
		UPDATE ST_USER_BASE /* stUserBaseTrx.updatePasswordByPasswordInitialize */
		   SET PWD 				  = #{pwd}
			 , LST_PWD_CHG_DTM	= now()
			 , PWD_CNTN_FAIL_CNT  = 0
 			 , PWD_INI_YN		 = 'N'
		     , SYS_MOD_ID = #{userId}
		     , SYS_MOD_DTM = NOW()
		 WHERE USER_ID = #{userId}
	</update>
</mapper>